<!DOCTYPE html>
<html debug="true">
  <head>
    <script src="http://extjs.cachefly.net/ext-3.4.0/adapter/ext/ext-base.js"></script>
    <script src="http://extjs.cachefly.net/ext-3.4.0/ext-all-debug.js"></script>
    <script type="text/javascript" src="../../../../externals/openlayers/lib/OpenLayers.js"></script>
    <script type="text/javascript" src="../../../../externals/geoext/lib/GeoExt.js"></script>

    <script type="text/javascript" src="../../../../examples/ux/treegrid/TreeGridSorter.js"></script>
    <script type="text/javascript" src="../../../../examples/ux/treegrid/TreeGridColumnResizer.js"></script>
    <script type="text/javascript" src="../../../../examples/ux/treegrid/TreeGridNodeUI.js"></script>
    <script type="text/javascript" src="../../../../examples/ux/treegrid/TreeGridLoader.js"></script>

    <script type="text/javascript" src="../../../../examples/ux/treegrid/TreeGridColumns.js"></script>
    <script type="text/javascript" src="../../../../examples/ux/treegrid/TreeGrid.js"></script>

    <script type="text/javascript" src="../../../../src/script/loader.js"></script>

    <script type="text/javascript">

        function createSymbolizers() {
            var symbolizers = [];
            symbolizers.push(new OpenLayers.Symbolizer.Point({
                graphicName: "star",
                pointRadius: 8,
                fillColor: "yellow",
                strokeColor: "red",
                strokeWidth: 1
            }));
            symbolizers.push(new OpenLayers.Symbolizer.Polygon({
                fillColor: "olive",
                strokeColor: "#666666",
                strokeWidth: 2,
                strokeDashstyle: "dot"
            }));
            symbolizers.push(new OpenLayers.Symbolizer.Polygon({
                fillColor: "blue",
                strokeColor: "black",
                strokeWidth: 2
            }));
            symbolizers.push(new OpenLayers.Symbolizer.Text({
                label: "${name}",
                labelAlign: "cm",
                fontColor: "#FF0000",
                fillColor: "yellow",
                graphicName: "square",
                pointRadius: 10
            }));
            return symbolizers;
        }
       
        function test_SymbolizerGrid(t) {
            t.plan(1);
            
            var instance = new gxp.grid.SymbolizerGrid({symbolizers: createSymbolizers(), symbolType: 'Polygon'});
            
            t.ok(instance instanceof gxp.grid.SymbolizerGrid, "Instance created successfully");
            instance.destroy();
        }

        function test_getSymbolizers(t) {
            t.plan(5);
            var instance = new gxp.grid.SymbolizerGrid({renderTo: Ext.getBody(), symbolizers: createSymbolizers(), symbolType: 'Polygon'});
            instance.render();
            t.eq(instance.getSymbolizers().length, 4, "All symbolizers returned");
            instance.root.eachChild(function(node) {
                var type = node.attributes.type;
                node.eachChild(function(n) {
                    if (type === 'Point') {
                         n.getUI().toggleCheck(false);
                    }
                });
            });
            t.eq(instance.getSymbolizers().length, 3, "Point symbolizer excluded since all children are unchecked");
            var poly = instance.root.findChild('type', 'Polygon');
            t.eq(poly.childNodes.length, 6, "The two PolygonSymbolizers are combined in one tree node, and an empty symbolizer was added as well");
            t.eq(poly.attributes.symbolizer[0].fillColor, "olive", "The olive fill is on top");
            poly.findChild('checked', false).getUI().toggleCheck(true);
            t.eq(poly.childNodes.length, 7, "Extra node inserted if last unchecked node gets checked");
            instance.destroy();
        }

    </script>
  </head>
  <body>
  </body>
</html>
